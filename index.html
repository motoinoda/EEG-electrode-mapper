<!DOCTYPE html>
<html lang="en" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EEG Electrode Layout Export Tool</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .language-btn {
            background: white;
            border: 2px solid #3498db;
            color: #3498db;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .language-btn:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .language-btn.active {
            background: #3498db;
            color: white;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.2em;
            font-weight: 300;
        }

        .electrode-count {
            font-size: 1.1em;
            margin-top: 10px;
            opacity: 0.9;
        }

        .content {
            display: flex;
            padding: 20px;
            gap: 20px;
        }

        .control-panel {
            flex: 0 0 280px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            height: fit-content;
        }

        .control-section {
            margin-bottom: 25px;
        }

        .control-section h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.1em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .preset-btn, .control-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .preset-btn:hover, .control-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .control-btn {
            width: 100%;
            margin-bottom: 10px;
        }

        .search-box {
            width: 100%;
            padding: 10px;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            font-size: 1em;
            box-sizing: border-box;
        }

        .search-box:focus {
            outline: none;
            border-color: #3498db;
        }

        .visualization-area {
            flex: 1;
            position: relative;
            background: white;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 600px;
        }

        .head-outline {
            position: relative;
            width: 500px;
            height: 600px;
        }

        .electrode {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ecf0f1;
            border: 2px solid #34495e;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: #2c3e50;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .electrode:hover {
            transform: scale(1.3);
            background: #f39c12;
            border-color: #d68910;
            z-index: 20;
        }

        .electrode.selected {
            background: #e74c3c;
            border-color: #c0392b;
            color: white;
        }

        .electrode.selected:hover {
            background: #c0392b;
        }

        .electrode.edit-mode {
            background: #9b59b6;
            border-color: #8e44ad;
            color: white;
        }

        .head-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .export-section {
            background: #e8f5e8;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #27ae60;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
        }

        .export-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
        }

        .export-btn:hover {
            background: #229954;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .edit-mode-active .electrode:not(.selected) {
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }

            .control-panel {
                flex: none;
            }

            .head-outline {
                width: 400px;
                height: 480px;
            }

            .language-switcher {
                position: relative;
                top: 0;
                right: 0;
                justify-content: center;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="language-switcher">
        <button class="language-btn active" onclick="switchLanguage('en')" id="lang-en">English</button>
        <button class="language-btn" onclick="switchLanguage('ja')" id="lang-ja">日本語</button>
    </div>

    <div class="container">
        <div class="header">
            <h1 id="main-title">EEG Electrode Layout Export Tool</h1>
            <div class="electrode-count" id="electrode-count">Selected electrodes: 0</div>
        </div>

        <div class="content">
            <div class="control-panel">
                <div class="control-section">
                    <h3 id="presets-title">Anatomical Presets</h3>
                    <div class="preset-buttons">
                        <button class="preset-btn" onclick="selectPreset('frontal')" id="frontal-btn">Frontal</button>
                        <button class="preset-btn" onclick="selectPreset('central')" id="central-btn">Central</button>
                        <button class="preset-btn" onclick="selectPreset('parietal')" id="parietal-btn">Parietal</button>
                        <button class="preset-btn" onclick="selectPreset('occipital')" id="occipital-btn">Occipital</button>
                        <button class="preset-btn" onclick="selectPreset('temporal')" id="temporal-btn">Temporal</button>
                        <button class="preset-btn" onclick="selectPreset('all')" id="all-btn">All</button>
                    </div>
                </div>

                <div class="control-section">
                    <h3 id="controls-title">Controls</h3>
                    <button class="control-btn" onclick="clearSelection()" id="clear-btn">Clear All</button>
                    <button class="control-btn" onclick="toggleEditMode()" id="edit-btn">Edit Mode</button>
                </div>

                <div class="control-section">
                    <h3 id="search-title">Search</h3>
                    <input type="text" class="search-box" id="electrode-search" placeholder="Search electrodes...">
                </div>

                <div class="control-section export-section">
                    <h3 id="export-title">Export Layout</h3>
                    <div class="export-buttons">
                        <button class="export-btn" onclick="exportSVG()" id="export-svg-btn">Export SVG</button>
                        <button class="export-btn" onclick="exportPNG()" id="export-png-btn">Export PNG</button>
                    </div>
                </div>
            </div>

            <div class="visualization-area">
                <div class="head-outline" id="head-container">
                    <svg class="head-svg" viewBox="0 0 500 600">
                        <ellipse cx="250" cy="350" rx="200" ry="240" fill="none" stroke="#34495e" stroke-width="3"/>
                        <path d="M 250 110 L 240 90 L 260 90 Z" fill="none" stroke="#34495e" stroke-width="2"/>
                        <circle cx="80" cy="320" r="15" fill="none" stroke="#34495e" stroke-width="2"/>
                        <circle cx="420" cy="320" r="15" fill="none" stroke="#34495e" stroke-width="2"/>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Language data
        const translations = {
            en: {
                title: "EEG Electrode Layout Export Tool",
                electrodeCount: "Selected electrodes",
                presetsTitle: "Anatomical Presets",
                controlsTitle: "Controls",
                searchTitle: "Search",
                exportTitle: "Export Layout",
                clearBtn: "Clear All",
                editBtn: "Edit Mode",
                exportSvgBtn: "Export SVG",
                exportPngBtn: "Export PNG",
                searchPlaceholder: "Search electrodes...",
                frontalBtn: "Frontal",
                centralBtn: "Central",
                parietalBtn: "Parietal",
                occipitalBtn: "Occipital",
                temporalBtn: "Temporal",
                allBtn: "All"
            },
            ja: {
                title: "EEG 電極配置図 保存ツール",
                electrodeCount: "選択された電極",
                presetsTitle: "解剖学的プリセット",
                controlsTitle: "コントロール",
                searchTitle: "検索",
                exportTitle: "配置図の出力",
                clearBtn: "全てクリア",
                editBtn: "編集モード",
                exportSvgBtn: "SVG出力",
                exportPngBtn: "PNG出力",
                searchPlaceholder: "電極を検索...",
                frontalBtn: "前頭",
                centralBtn: "中心",
                parietalBtn: "頭頂",
                occipitalBtn: "後頭",
                temporalBtn: "側頭",
                allBtn: "全て"
            }
        };

        let currentLanguage = 'en';
        let selectedElectrodes = new Set();
        let electrodeData = [];
        let editMode = false;

        // Language switching function
        function switchLanguage(lang) {
            currentLanguage = lang;
            document.getElementById('html-root').lang = lang;

            // Update button states
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            document.getElementById('lang-ja').classList.toggle('active', lang === 'ja');

            // Update text content
            const t = translations[lang];
            document.getElementById('main-title').textContent = t.title;
            document.getElementById('presets-title').textContent = t.presetsTitle;
            document.getElementById('controls-title').textContent = t.controlsTitle;
            document.getElementById('search-title').textContent = t.searchTitle;
            document.getElementById('export-title').textContent = t.exportTitle;
            document.getElementById('clear-btn').textContent = t.clearBtn;
            document.getElementById('edit-btn').textContent = t.editBtn;
            document.getElementById('export-svg-btn').textContent = t.exportSvgBtn;
            document.getElementById('export-png-btn').textContent = t.exportPngBtn;
            document.getElementById('electrode-search').placeholder = t.searchPlaceholder;
            document.getElementById('frontal-btn').textContent = t.frontalBtn;
            document.getElementById('central-btn').textContent = t.centralBtn;
            document.getElementById('parietal-btn').textContent = t.parietalBtn;
            document.getElementById('occipital-btn').textContent = t.occipitalBtn;
            document.getElementById('temporal-btn').textContent = t.temporalBtn;
            document.getElementById('all-btn').textContent = t.allBtn;

            updateElectrodeCount();
        }

        // Load electrode data and initialize
        fetch('electrode_correction_list_new.json')
            .then(response => response.json())
            .then(data => {
                electrodeData = data;
                createElectrodes();
                setupSearch();
            })
            .catch(error => {
                console.error('Error loading electrode data:', error);
            });

        function createElectrodes() {
            const container = document.getElementById('head-container');

            electrodeData.forEach(electrode => {
                const electrodeElement = document.createElement('div');
                electrodeElement.className = 'electrode';
                electrodeElement.textContent = electrode.name;
                electrodeElement.title = electrode.name;

                const x = (electrode.x + 1) * 250;
                const y = (electrode.y + 1) * 300;

                electrodeElement.style.left = (x - 10) + 'px';
                electrodeElement.style.top = (y - 10) + 'px';

                electrodeElement.addEventListener('click', () => toggleElectrode(electrode.name));

                container.appendChild(electrodeElement);
            });
        }

        function toggleElectrode(name) {
            if (editMode) {
                const newName = prompt(`Enter new name for ${name}:`, name);
                if (newName && newName !== name) {
                    const electrodeElement = [...document.querySelectorAll('.electrode')].find(el => el.textContent === name);
                    if (electrodeElement) {
                        electrodeElement.textContent = newName;
                        electrodeElement.title = newName;
                    }
                }
                return;
            }

            if (selectedElectrodes.has(name)) {
                selectedElectrodes.delete(name);
            } else {
                selectedElectrodes.add(name);
            }

            updateElectrodeDisplay();
            updateElectrodeCount();
        }

        function updateElectrodeDisplay() {
            document.querySelectorAll('.electrode').forEach(el => {
                el.classList.toggle('selected', selectedElectrodes.has(el.textContent));
            });
        }

        function updateElectrodeCount() {
            const t = translations[currentLanguage];
            document.getElementById('electrode-count').textContent = `${t.electrodeCount}: ${selectedElectrodes.size}`;
        }

        function selectPreset(presetType) {
            const presets = {
                frontal: ['Fp1', 'Fp2', 'AF7', 'AF3', 'AFz', 'AF4', 'AF8', 'F7', 'F5', 'F3', 'F1', 'Fz', 'F2', 'F4', 'F6', 'F8'],
                central: ['FC5', 'FC3', 'FC1', 'FCz', 'FC2', 'FC4', 'FC6', 'C5', 'C3', 'C1', 'Cz', 'C2', 'C4', 'C6'],
                parietal: ['CP5', 'CP3', 'CP1', 'CPz', 'CP2', 'CP4', 'CP6', 'P7', 'P5', 'P3', 'P1', 'Pz', 'P2', 'P4', 'P6', 'P8'],
                occipital: ['PO7', 'PO3', 'POz', 'PO4', 'PO8', 'O1', 'Oz', 'O2'],
                temporal: ['FT7', 'FT8', 'T7', 'T8', 'TP7', 'TP8'],
                all: electrodeData.map(e => e.name)
            };

            selectedElectrodes.clear();
            presets[presetType].forEach(name => {
                if (electrodeData.some(e => e.name === name)) {
                    selectedElectrodes.add(name);
                }
            });

            updateElectrodeDisplay();
            updateElectrodeCount();
        }

        function clearSelection() {
            selectedElectrodes.clear();
            updateElectrodeDisplay();
            updateElectrodeCount();
        }

        function toggleEditMode() {
            editMode = !editMode;
            document.body.classList.toggle('edit-mode-active', editMode);
            document.querySelectorAll('.electrode').forEach(el => {
                el.classList.toggle('edit-mode', editMode);
            });
        }

        function setupSearch() {
            const searchBox = document.getElementById('electrode-search');
            searchBox.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                document.querySelectorAll('.electrode').forEach(electrode => {
                    const matches = electrode.textContent.toLowerCase().includes(searchTerm);
                    electrode.style.opacity = matches || searchTerm === '' ? '1' : '0.3';
                });
            });
        }

        function exportSVG() {
            const svg = createExportSVG();
            const blob = new Blob([svg], {type: 'image/svg+xml'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `electrode_layout_${selectedElectrodes.size}_electrodes_${new Date().toISOString().split('T')[0]}.svg`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportPNG() {
            const svg = createExportSVG();
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();

            canvas.width = 800;
            canvas.height = 960;

            img.onload = function() {
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                canvas.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `electrode_layout_${selectedElectrodes.size}_electrodes_${new Date().toISOString().split('T')[0]}.png`;
                    a.click();
                    URL.revokeObjectURL(url);
                });
            };

            const blob = new Blob([svg], {type: 'image/svg+xml'});
            const url = URL.createObjectURL(blob);
            img.src = url;
        }

        function createExportSVG() {
            let svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 600" width="500" height="600">`;

            // Head outline
            svg += `<ellipse cx="250" cy="350" rx="200" ry="240" fill="none" stroke="#34495e" stroke-width="3"/>`;
            // Nose
            svg += `<path d="M 250 110 L 240 90 L 260 90 Z" fill="none" stroke="#34495e" stroke-width="2"/>`;
            // Ears
            svg += `<circle cx="80" cy="320" r="15" fill="none" stroke="#34495e" stroke-width="2"/>`;
            svg += `<circle cx="420" cy="320" r="15" fill="none" stroke="#34495e" stroke-width="2"/>`;

            // Electrodes
            electrodeData.forEach(electrode => {
                const isSelected = selectedElectrodes.has(electrode.name);
                const x = (electrode.x + 1) * 250;
                const y = (electrode.y + 1) * 300;
                const color = isSelected ? '#e74c3c' : '#ecf0f1';
                const strokeColor = isSelected ? '#c0392b' : '#34495e';
                const textColor = isSelected ? 'white' : '#2c3e50';

                svg += `<circle cx="${x}" cy="${y}" r="10" fill="${color}" stroke="${strokeColor}" stroke-width="2"/>`;
                svg += `<text x="${x}" y="${y + 3}" text-anchor="middle" font-family="Arial" font-size="10" font-weight="bold" fill="${textColor}">${electrode.name}</text>`;
            });

            svg += `</svg>`;
            return svg;
        }
    </script>
</body>
</html>